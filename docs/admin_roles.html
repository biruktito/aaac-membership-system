<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AAAC Admin — Manage Roles</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background:#f8fafc; color:#0f172a; }
    header { padding: 16px; background:#0ea5e9; color:white; }
    main { padding: 16px; max-width: 800px; margin: 0 auto; }
    .card { background:white; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); padding: 14px; margin: 12px 0; }
    input, select { width: 100%; padding:10px; border:1px solid #cbd5e1; border-radius:8px; margin: 6px 0; }
    button { background:#0ea5e9; color:white; border:0; padding:10px 14px; border-radius:8px; cursor:pointer; }
    .muted { color:#475569; font-size: 13px; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script>
    // Inline Firebase config (same as v2 pages)
    window.firebaseConfig = window.firebaseConfig || {
      apiKey: "AIzaSyDa4rimRWUUgPp7LAAaZzyrn13MKM-9naA",
      authDomain: "aaac-membership-1221.firebaseapp.com",
      projectId: "aaac-membership-1221",
      storageBucket: "aaac-membership-1221.firebasestorage.app",
      messagingSenderId: "134230731518",
      appId: "1:134230731518:web:2eb24bfa5cb9e9df2453af",
      measurementId: "G-YJJD19WXBG",
    };
  </script>
  <script src="firebase-init.js"></script>
</head>
<body>
  <header>
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div>
        <div style="font-weight:700; font-size:18px;">AAAC Admin — Roles Manager</div>
        <div class="muted">Set user roles and member linkage. Use with admin account.</div>
      </div>
      <div>
        <button id="btnEmail">Sign in with Email</button>
        <button id="btnAnon">Sign in Anonymously</button>
        <button id="btnOut">Sign out</button>
      </div>
    </div>
  </header>
  <main>
    <div class="card">
      <div style="font-weight:600;">Set Role for UID</div>
      <div class="muted">Paste a Firebase Authentication UID, choose a role, and optionally link a memberId.</div>
      <label>UID</label>
      <input id="uid" placeholder="paste Firebase UID" />
      <label>Role</label>
      <select id="role">
        <option value="member">member</option>
        <option value="board">board</option>
        <option value="admin">admin</option>
      </select>
      <label>Member ID (optional for board/admin; required for member)</label>
      <input id="memberId" placeholder="e.g., 24" />
      <button id="btnSave">Save Role</button>
      <div id="status" class="muted" style="margin-top:8px;">Idle</div>
    </div>

    <div class="card">
      <div style="font-weight:600;">Quick Tips</div>
      <ul>
        <li class="muted">Get UID from Firebase Console → Authentication → Users</li>
        <li class="muted">After saving, refresh the dashboard_v2 page to see updates</li>
      </ul>
    </div>
  </main>

  <script>
    const { auth, db } = window.firebaseServices || {};
    
    // Email/Password sign-in
    document.getElementById('btnEmail').onclick = async () => {
      const email = prompt('Enter email:');
      if (!email) return;
      const password = prompt('Enter password:');
      if (!password) return;
      try {
        await auth.signInWithEmailAndPassword(email, password);
        alert('Signed in successfully!');
      } catch(e) {
        alert('Sign in failed: ' + e.message);
      }
    };
    
    document.getElementById('btnAnon').onclick = async () => { try { await auth.signInAnonymously(); } catch(e){ alert('Signin failed'); } };
    document.getElementById('btnOut').onclick = async () => { try { await auth.signOut(); } catch(e){ alert('Signout failed'); } };

    document.getElementById('btnSave').onclick = async () => {
      const uid = document.getElementById('uid').value.trim();
      const role = document.getElementById('role').value;
      const memberId = document.getElementById('memberId').value.trim();
      if (!uid) { alert('UID required'); return; }
      if (role === 'member' && !memberId) { alert('memberId required for member role'); return; }
      try {
        await db.collection('roles').doc(uid).set({ role, ...(memberId ? { memberId } : {}) }, { merge: true });
        document.getElementById('status').textContent = 'Saved.';
        alert('Role saved.');
      } catch (e) {
        console.error(e);
        document.getElementById('status').textContent = 'Error: ' + (e.message || e);
        alert('Failed to save');
      }
    };
  </script>
</body>
</html>


